{% extends 'base.html' %}
{% block title %}DLNS â€¢ Community{% endblock %}

{% block content %}
<section class="card">
  <header>
    <h2>Community</h2>
    <p class="muted">Support the Deadlock community and keep the community thriving.</p>
    <p class="muted" style="margin-top:0.25rem;">If you feel you fit in to the Deadlock Community, reach out to get your channel/links added.</p>
  </header>

  {% if not groups %}
    <p class="muted">No community links yet.</p>
  {% else %}
    {% macro render_groups(group_list) %}
      {% for g in group_list %}
        {% set items = g['items']|default([], true) %}
        {% set subgroups = g['groups']|default([], true) %}
        <details class="community-group" style="border:1px solid var(--pico-muted-border-color,#e5e7eb); border-radius:10px; padding:0.25rem 0.5rem; margin:0;">
          <summary style="list-style:none; cursor:pointer; padding:0.5rem; border-radius:8px; font-weight:600;">
            {{ g.group }}
            {% set count = (items|length) + (subgroups|length) %}
            {% if count %} <span class="muted" style="font-weight:400;">({{ count }})</span>{% endif %}
          </summary>
          <div style="padding:0.25rem 0.5rem 0.75rem 0.5rem;">
            {% if items %}
              <div class="grid" style="gap:0.75rem; margin-bottom:0.5rem;">
                {% for e in items %}
                  <article class="entry" style="padding:0.6rem 0.8rem; border:1px solid var(--pico-muted-border-color,#e5e7eb); border-radius:8px;">
                    <h4 style="margin:0 0 0.25rem 0; font-size:1rem;">
                      {% if e.url %}<a class="chip-button" href="{{ e.url }}" target="_blank" rel="noopener noreferrer">{{ e.name }}</a>
                      {% else %}{{ e.name }}{% endif %}
                    </h4>
                    {% if e.description %}
                      <p class="muted" style="margin:0;">{{ e.description }}</p>
                    {% endif %}
                  </article>
                {% endfor %}
              </div>
            {% endif %}

            {% if subgroups %}
              <div class="stack" style="display:flex; flex-direction:column; gap:0.5rem;">
                {{ render_groups(subgroups) }}
              </div>
            {% endif %}

            {% if not items and not subgroups %}
              <p class="muted" style="margin:0;">No links in this group yet.</p>
            {% endif %}
          </div>
        </details>
      {% endfor %}
    {% endmacro %}

    <div class="stack" style="display:flex; flex-direction:column; gap:1rem;">
      {{ render_groups(groups) }}
    </div>
  {% endif %}

  <footer style="margin-top:1rem;">
    <a class="button secondary" href="/">Back</a>
  </footer>
</section>
{% endblock %}

{% block scripts %}{% endblock %}