{% extends 'base.html' %}
{% block title %}DLNS ‚Ä¢ Community{% endblock %}

{% block content %}
<section class="card">
  <header>
    <h2>
      <span style="color: #8b5cf6; margin-right: 0.5rem;" aria-hidden="true">üåü</span>
      Community Hub
    </h2>
    <p class="muted">Support the Deadlock community and help keep it thriving. Connect with creators, streamers, and fellow players.</p>
    <div class="alert info" style="margin-top: 1rem;">
      <p style="margin: 0;">
        <strong>Want to be featured?</strong> If you're part of the Deadlock community and have content or resources to share, 
        reach out to get your channel or links added to this page.
      </p>
    </div>
  </header>

  {% if not groups %}
    <div class="alert warning">
      <h4 style="margin: 0 0 0.5rem 0;">No Community Links Yet</h4>
      <p style="margin: 0;">Community links will appear here as they become available. Check back soon!</p>
    </div>
  {% else %}
    {% macro render_groups(group_list) %}
      {% for g in group_list %}
        {% set items = g['items']|default([], true) %}
        {% set subgroups = g['groups']|default([], true) %}
        {% set total_count = (items|length) + (subgroups|length) %}
        
        <section class="card" style="margin: 1rem 0;">
          <details style="border: none;">
            <summary style="cursor: pointer; padding: 0; margin: 0; list-style: none; user-select: none;">
              <header style="margin: 0; padding: 1rem; border-radius: 8px; transition: background-color 0.2s ease;" class="hover:bg-muted">
                <h3 style="margin: 0; display: flex; align-items: center; justify-content: space-between;">
                  <span style="display: flex; align-items: center; gap: 0.75rem;">
                    <span class="collapse-icon" style="transition: transform 0.2s ease; font-size: 0.9rem;" aria-hidden="true">‚ñ∂</span>
                    {{ g.group }}
                  </span>
                  {% if total_count %}
                    <span class="badge neutral">{{ total_count }}</span>
                  {% endif %}
                </h3>
              </header>
            </summary>
            
            <div class="collapsible-content" style="padding: 0 1rem 1rem 1rem;">
              {% if items %}
                <div class="stagger-in" style="display: grid; gap: 1rem; margin: 1rem 0;">
                  {% for e in items %}
                    <div style="padding: 1rem; border: 1px solid color-mix(in oklab, var(--pico-muted-border-color) 50%, transparent); border-radius: 12px; transition: all 0.2s ease;" class="hover:shadow-md">
                      <div style="display: flex; align-items: start; justify-content: space-between; flex-wrap: wrap; gap: 0.75rem;">
                        <div style="flex: 1; min-width: 200px;">
                          <h4 style="margin: 0 0 0.5rem 0; font-size: 1.1rem; font-weight: 600;">
                            {{ e.name }}
                          </h4>
                          {% if e.description %}
                            <p class="text-muted" style="margin: 0; line-height: 1.5;">{{ e.description }}</p>
                          {% endif %}
                        </div>
                        {% if e.url %}
                          <a href="{{ e.url }}" 
                             target="_blank" 
                             rel="noopener noreferrer" 
                             class="chip-button primary bounce-on-click"
                             style="flex-shrink: 0;">
                            <span aria-hidden="true">üîó</span>
                            Visit
                          </a>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% endif %}

              {% if subgroups %}
                <div style="margin-top: 1rem;">
                  {{ render_groups(subgroups) }}
                </div>
              {% endif %}

              {% if not items and not subgroups %}
                <div class="alert info">
                  <p style="margin: 0;">No links available in this group yet. Content will be added as it becomes available.</p>
                </div>
              {% endif %}
            </div>
          </details>
        </section>
      {% endfor %}
    {% endmacro %}

    <div style="margin-top: 1rem;">
      {{ render_groups(groups) }}
    </div>
  {% endif %}

  <footer>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
      <a href="{{ url_for('index') }}" class="chip-button bounce-on-click">
        <span aria-hidden="true">üè†</span>
        Back to Home
      </a>
      <a href="{{ url_for('help_page') }}" class="chip-button bounce-on-click">
        <span aria-hidden="true">‚ù§Ô∏è</span>
        Help & Contribute
      </a>
    </div>
  </footer>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Handle collapsible sections
  const details = document.querySelectorAll('details');
  
  details.forEach(detail => {
    const summary = detail.querySelector('summary');
    const icon = summary.querySelector('.collapse-icon');
    const content = detail.querySelector('.collapsible-content');
    
    // Set up toggle functionality
    detail.addEventListener('toggle', function() {
      if (detail.open) {
        // Opening
        icon.style.transform = 'rotate(90deg)';
        icon.textContent = '‚ñº';
        
        // Animate content in
        if (content) {
          content.style.opacity = '0';
          content.style.transform = 'translateY(-10px)';
          
          // Trigger stagger animation for items
          const staggerItems = content.querySelectorAll('.stagger-in > *');
          staggerItems.forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
              item.style.transition = 'all 0.3s ease';
              item.style.opacity = '1';
              item.style.transform = 'translateY(0)';
            }, index * 50 + 100);
          });
          
          // Animate container
          requestAnimationFrame(() => {
            content.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            content.style.opacity = '1';
            content.style.transform = 'translateY(0)';
          });
        }
      } else {
        // Closing
        icon.style.transform = 'rotate(0deg)';
        icon.textContent = '‚ñ∂';
      }
    });
    
    // Add hover effect to summary
    summary.addEventListener('mouseenter', function() {
      const header = summary.querySelector('header');
      if (header) {
        header.style.backgroundColor = 'color-mix(in oklab, var(--pico-muted-border-color) 20%, transparent)';
      }
    });
    
    summary.addEventListener('mouseleave', function() {
      const header = summary.querySelector('header');
      if (header) {
        header.style.backgroundColor = '';
      }
    });
  });
});
</script>
{% endblock %}