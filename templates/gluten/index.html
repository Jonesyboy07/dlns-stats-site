{% extends "base.html" %}
{% block title %}Deadlock Mods{% endblock %}

{% block content %}
<section class="container">

  <h1>Deadlock Mods</h1>
  <p class="muted">Download official Deadlock mods and install them easily with the DLNS Mod Installer.</p>

  {% if can_upload %}
    <a href="{{ url_for('gluten.upload_page') }}" class="button">Manage Mods</a>
  {% endif %}

  <hr>

  <!-- Installer Section -->
  <h2>Mod Installer</h2>
  <p class="muted">Use the official installer for safe and simple mod installation.</p>

  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem;">

    <article class="card">
      <header><h3>Installer (Python)</h3></header>
      <p class="muted">Recommended for most users. Python required.</p>
      <footer>
        <a href="{{ url_for('gluten.download_installer_py') }}" class="button">Download .py</a>
      </footer>
    </article>

    <article class="card">
      <header><h3>Installer (EXE)</h3></header>
      <p class="muted">No Python required. Windows-ready installer.</p>
      <footer>
        <a href="{{ url_for('gluten.download_installer_exe') }}" class="button">Download .exe</a>
      </footer>
    </article>

  </div>

  <!-- Installer Source Code -->
  <p style="margin-top: 0.75rem;">
    <a href="{{ url_for('gluten.view_source') }}" class="button outline">View Installer Source Code</a>
  </p>

  <!-- Installer Version Info -->
  <p id="installerVersion" class="muted" style="margin-top: 0.25rem;">Checking installer version...</p>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch("/gluten/api/version")
        .then(r => r.json())
        .then(v => {
          document.getElementById("installerVersion").textContent =
            "Latest installer version: " + v.version;
        })
        .catch(() => {
          document.getElementById("installerVersion").textContent =
            "Unable to load installer version.";
        });
    });
  </script>

  <hr>

  <!-- Mods List -->
  <h2>Available Mods</h2>

  {% if mods|length == 0 %}
    <p class="muted">No mods have been uploaded yet.</p>
  {% else %}
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.25rem;">
      {% for mod in mods %}
      <article class="card">
        <header>
          <h3>{{ mod.title }}</h3>
          <p class="muted" style="font-size: 0.8rem;">
            Uploaded: {{ mod.uploaded_at }}
          </p>
        </header>
        <footer>
          <a href="{{ url_for('gluten.download_mod', mod_id=mod.id) }}" class="button">
            Download
          </a>
        </footer>
      </article>
      {% endfor %}
    </div>
  {% endif %}

</section>
{% endblock %}
