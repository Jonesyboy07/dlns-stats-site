{% extends "base.html" %}

{% block title %}Statistics ‚Ä¢ DLNS Stats{% endblock %}

{% block content %}
<section class="card">
    <header>
        <h2>
            <span style="color: #8b5cf6; margin-right: 0.5rem;" aria-hidden="true">üìä</span>
            DLNS Statistics
        </h2>
        <p class="muted">Comprehensive statistics from all tracked matches and players in the DLNS community.</p>
    </header>

    <!-- Basic Stats Grid -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 2rem 0;">
        <div class="text-center" style="padding: 1.5rem; background: color-mix(in oklab, var(--pico-primary) 10%, transparent); border-radius: 12px; border: 1px solid color-mix(in oklab, var(--pico-primary) 20%, transparent);">
            <div style="font-size: 2rem; font-weight: 700; color: var(--pico-primary); margin-bottom: 0.5rem;">
                {{ "{:,}".format(stats.basic.match_count) }}
            </div>
            <div style="font-size: 0.9rem; font-weight: 600; color: var(--pico-color); margin-bottom: 0.25rem;">Total Matches</div>
            <div class="text-small text-muted">All Time</div>
        </div>

        <div class="text-center" style="padding: 1.5rem; background: color-mix(in oklab, #10b981 10%, transparent); border-radius: 12px; border: 1px solid color-mix(in oklab, #10b981 20%, transparent);">
            <div style="font-size: 2rem; font-weight: 700; color: #10b981; margin-bottom: 0.5rem;">
                {{ "{:,}".format(stats.basic.user_count) }}
            </div>
            <div style="font-size: 0.9rem; font-weight: 600; color: var(--pico-color); margin-bottom: 0.25rem;">Total Players</div>
            <div class="text-small text-muted">All Time</div>
        </div>

        {% if stats.basic.avg_match_duration %}
        <div class="text-center" style="padding: 1.5rem; background: color-mix(in oklab, #f59e0b 10%, transparent); border-radius: 12px; border: 1px solid color-mix(in oklab, #f59e0b 20%, transparent);">
            <div style="font-size: 2rem; font-weight: 700; color: #f59e0b; margin-bottom: 0.5rem;">
                {{ (stats.basic.avg_match_duration / 60) | round(1) }}m
            </div>
            <div style="font-size: 0.9rem; font-weight: 600; color: var(--pico-color); margin-bottom: 0.25rem;">Avg Duration</div>
            <div class="text-small text-muted">Per Match</div>
        </div>
        {% endif %}
    </div>
</section>

{% if stats.hero_stats %}
<section class="card" style="margin-top: 1.5rem;">
    <header>
        <h3>
            <span style="color: #ef4444; margin-right: 0.5rem;" aria-hidden="true">ü¶∏</span>
            Hero Selection
        </h3>
        <p class="muted">Most popular heroes across all matches.</p>
    </header>
    
    <div class="table-responsive">
        <table role="grid" class="striped">
            <thead>
                <tr>
                    <th>Hero</th>
                    <th class="hide-on-mobile">Picks</th>
                    <th class="hide-on-mobile">Win Rate</th>
                    <th>Popularity</th>
                </tr>
            </thead>
            <tbody class="stagger-in">
                {% for hero in stats.hero_stats[:10] %}
                <tr>
                    <td>
                        <strong>{{ hero.hero_name or "Unknown Hero" }}</strong>
                        <div class="show-on-mobile text-small text-muted" style="margin-top: 0.25rem;">
                            {{ hero.pick_count }} picks ‚Ä¢ {{ (hero.win_rate * 100) | round(1) }}% wins
                        </div>
                    </td>
                    <td class="hide-on-mobile">
                        <span class="badge neutral">{{ hero.pick_count }}</span>
                    </td>
                    <td class="hide-on-mobile">
                        <span class="badge {{ 'win' if hero.win_rate >= 0.5 else 'loss' }}">
                            {{ (hero.win_rate * 100) | round(1) }}%
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="flex: 1; height: 6px; background: color-mix(in oklab, var(--pico-muted-border-color) 30%, transparent); border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; background: var(--pico-primary); width: {{ (hero.pick_percentage * 100) | round(1) }}%; transition: width 0.3s ease;"></div>
                            </div>
                            <span class="text-small">{{ (hero.pick_percentage * 100) | round(1) }}%</span>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endif %}

{% if stats.team_stats %}
<section class="card" style="margin-top: 1.5rem;">
    <header>
        <h3>
            <span style="color: #3b82f6; margin-right: 0.5rem;" aria-hidden="true">‚öñÔ∏è</span>
            Team Balance
        </h3>
        <p class="muted">Win rates and performance by team side.</p>
    </header>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 1rem 0;">
        {% for team in stats.team_stats %}
        <div style="text-align: center; padding: 1.5rem; border-radius: 12px; border: 2px solid {{ '#d97706' if team.team == 0 else '#2563eb' }}; background: color-mix(in oklab, {{ '#d97706' if team.team == 0 else '#2563eb' }} 8%, transparent);">
            <h4 style="margin: 0 0 1rem 0; color: {{ '#d97706' if team.team == 0 else '#2563eb' }}; font-size: 1.25rem;">
                {{ team.team | team_name }} Team
            </h4>
            <div style="font-size: 2.5rem; font-weight: 700; color: {{ '#d97706' if team.team == 0 else '#2563eb' }}; margin-bottom: 0.5rem;">
                {{ (team.win_rate * 100) | round(1) }}%
            </div>
            <div class="text-muted">Win Rate</div>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid color-mix(in oklab, {{ '#d97706' if team.team == 0 else '#2563eb' }} 20%, transparent);">
                <div class="text-small"><strong>{{ team.total_matches }}</strong> matches</div>
                <div class="text-small"><strong>{{ team.wins }}</strong> wins</div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% if stats.recent_activity %}
<section class="card" style="margin-top: 1.5rem;">
    <header>
        <h3>
            <span style="color: #10b981; margin-right: 0.5rem;" aria-hidden="true">üìà</span>
            Recent Activity
        </h3>
        <p class="muted">Activity trends over the past 30 days.</p>
    </header>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 1rem 0;">
        <div class="text-center">
            <div style="font-size: 1.5rem; font-weight: 600; color: var(--pico-primary);">
                {{ stats.recent_activity.matches_last_7_days or 0 }}
            </div>
            <div class="text-small text-muted">Last 7 Days</div>
        </div>
        <div class="text-center">
            <div style="font-size: 1.5rem; font-weight: 600; color: var(--pico-primary);">
                {{ stats.recent_activity.matches_last_30_days or 0 }}
            </div>
            <div class="text-small text-muted">Last 30 Days</div>
        </div>
        <div class="text-center">
            <div style="font-size: 1.5rem; font-weight: 600; color: var(--pico-primary);">
                {{ stats.recent_activity.avg_daily_matches or 0 }}
            </div>
            <div class="text-small text-muted">Daily Average</div>
        </div>
    </div>
</section>
{% endif %}

<section class="card" style="margin-top: 1.5rem;">
    <header>
        <h3>
            <span style="color: #6366f1; margin-right: 0.5rem;" aria-hidden="true">‚ÑπÔ∏è</span>
            About These Stats
        </h3>
    </header>
    
    <div class="alert info">
        <ul style="margin: 0; padding-left: 1.25rem; line-height: 1.6;">
            <li>Statistics are updated automatically as new matches are processed</li>
            <li>Data includes all tracked DLNS and Fight Night games</li>
            <li>Hero statistics require at least 10 picks to be displayed</li>
            <li>Team balance shows overall win rates across all matches</li>
        </ul>
    </div>
    
    <footer>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
            <a href="{{ url_for('index') }}" class="chip-button bounce-on-click">
                <span aria-hidden="true">üè†</span>
                Back to Home
            </a>
            <a href="{{ url_for('search') }}" class="chip-button bounce-on-click">
                <span aria-hidden="true">üîç</span>
                Search Players
            </a>
        </div>
    </footer>
</section>

<style>
/* Additional mobile enhancements for statistics */
@media (max-width: 767px) {
    .stats-grid {
        grid-template-columns: 1fr !important;
    }
    
    .stat-card {
        text-align: center !important;
    }
    
    .progress-bar {
        height: 8px !important;
    }
}

/* Progress bar animations */
.progress-bar {
    animation: fillProgress 1s ease-out 0.5s both;
}

@keyframes fillProgress {
    from { width: 0%; }
    to { width: var(--progress-width); }
}
</style>
{% endblock %}