{% extends "base.html" %}

{% block title %}Statistics - DLNS Stats{% endblock %}

{% block content %}
<div class="container">
    <header>
        <h1>📊 DLNS Statistics</h1>
        <p>Comprehensive statistics from all tracked matches and players</p>
    </header>

    <!-- Basic Stats Grid -->
    <section class="stats-grid">
        <article class="stat-card">
            <h3>🎮 Total Matches</h3>
            <div class="stat-number">{{ "{:,}".format(stats.basic.match_count) }}</div>
            <small>All Time</small>
        </article>

        <article class="stat-card">
            <h3>👥 Total Players</h3>
            <div class="stat-number">{{ "{:,}".format(stats.basic.user_count) }}</div>
            <small>All Time</small>
        </article>

    </section>

    <!-- Hero Selection Statistics -->
    <section>
        <h2>🦸 Hero Selection</h2>
        <div class="stats-grid">
            <article class="stat-card highlight">
                <h4>⭐ Most Picked Hero</h4>
                <div class="stat-number">{{ stats.heroes.most_picked.hero_name }}</div>
                <small>{{ "{:,}".format(stats.heroes.most_picked.pick_count) }} times picked</small>
            </article>

            <article class="stat-card">
                <h4>🔸 Least Picked Hero</h4>
                <div class="stat-number">{{ stats.heroes.least_picked.hero_name }}</div>
                <small>{{ "{:,}".format(stats.heroes.least_picked.pick_count) }} times picked</small>
            </article>
        </div>
    </section>

    <!-- Combat Statistics -->
    <section>
        <h2>⚔️ Combat Statistics</h2>
        <div class="stats-grid">
            <article class="stat-card">
                <h4>💀 Kills</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_kills) }}</div>
                <small>Avg: {{ stats.combat.avg_kills }} per match</small>
            </article>

            <article class="stat-card">
                <h4>☠️ Deaths</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_deaths) }}</div>
                <small>Avg: {{ stats.combat.avg_deaths }} per match</small>
            </article>

            <article class="stat-card">
                <h4>🤝 Assists</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_assists) }}</div>
                <small>Avg: {{ stats.combat.avg_assists }} per match</small>
            </article>

            <article class="stat-card">
                <h4>💥 Player Damage</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_player_damage) }}</div>
            </article>

            <article class="stat-card">
                <h4>🏗️ Objective Damage</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_obj_damage) }}</div>
            </article>

            <article class="stat-card">
                <h4>💚 Healing</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_player_healing) }}</div>
            </article>

            <article class="stat-card highlight">
                <h4>💰 Souls</h4>
                <div class="stat-number">{{ "{:,}".format(stats.combat.total_net_worth) }}</div>
                <small>Avg: {{ "{:,}".format(stats.combat.avg_net_worth | round | int) }} per match</small>
            </article>
        </div>
    </section>

    <!-- Hero Records -->
    <section>
        <h2>🏅 Hero Performance Records</h2>
        <div class="stats-grid">
            {% if stats.hero_records.kills %}
            <article class="stat-card record">
                <h4>💀 Best Kills</h4>
                <div class="stat-number">{{ stats.hero_records.kills.value }}</div>
                <div class="hero-name">{{ stats.hero_records.kills.hero_name }}</div>
                <small>by {{ stats.hero_records.kills.player or "Unknown" }} in <a href="{{ url_for('match_detail', match_id=stats.hero_records.kills.match_id) }}">#{{ stats.hero_records.kills.match_id }}</a></small>
            </article>
            {% endif %}

            {% if stats.hero_records.damage %}
            <article class="stat-card record">
                <h4>💥 Best Damage</h4>
                <div class="stat-number">{{ "{:,}".format(stats.hero_records.damage.value) }}</div>
                <div class="hero-name">{{ stats.hero_records.damage.hero_name }}</div>
                <small>by {{ stats.hero_records.damage.player or "Unknown" }} in <a href="{{ url_for('match_detail', match_id=stats.hero_records.damage.match_id) }}">#{{ stats.hero_records.damage.match_id }}</a></small>
            </article>
            {% endif %}

            {% if stats.hero_records.healing %}
            <article class="stat-card record">
                <h4>💚 Best Healing</h4>
                <div class="stat-number">{{ "{:,}".format(stats.hero_records.healing.value) }}</div>
                <div class="hero-name">{{ stats.hero_records.healing.hero_name }}</div>
                <small>by {{ stats.hero_records.healing.player or "Unknown" }} in <a href="{{ url_for('match_detail', match_id=stats.hero_records.healing.match_id) }}">#{{ stats.hero_records.healing.match_id }}</a></small>
            </article>
            {% endif %}

            {% if stats.hero_records.souls %}
            <article class="stat-card record">
                <h4>💰 Best Souls</h4>
                <div class="stat-number">{{ "{:,}".format(stats.hero_records.souls.value) }}</div>
                <div class="hero-name">{{ stats.hero_records.souls.hero_name }}</div>
                <small>by {{ stats.hero_records.souls.player or "Unknown" }} in <a href="{{ url_for('match_detail', match_id=stats.hero_records.souls.match_id) }}">#{{ stats.hero_records.souls.match_id }}</a></small>
            </article>
            {% endif %}

            {% if stats.hero_records.last_hits %}
            <article class="stat-card record">
                <h4>⚡ Best Last Hits</h4>
                <div class="stat-number">{{ "{:,}".format(stats.hero_records.last_hits.value) }}</div>
                <div class="hero-name">{{ stats.hero_records.last_hits.hero_name }}</div>
                <small>by {{ stats.hero_records.last_hits.player or "Unknown" }} in <a href="{{ url_for('match_detail', match_id=stats.hero_records.last_hits.match_id) }}">#{{ stats.hero_records.last_hits.match_id }}</a></small>
            </article>
            {% endif %}
        </div>
    </section>

    <!-- Shooting Statistics -->
    <section>
        <h2>🎯 Shooting Statistics</h2>
        <div class="stats-grid">
            <article class="stat-card">
                <h4>🎯 Shots Hit</h4>
                <div class="stat-number">{{ "{:,}".format(stats.shooting.total_shots_hit) }}</div>
            </article>

            <article class="stat-card">
                <h4>❌ Shots Missed</h4>
                <div class="stat-number">{{ "{:,}".format(stats.shooting.total_shots_missed) }}</div>
            </article>

            <article class="stat-card">
                <h4>🔫 Total Shots Fired</h4>
                <div class="stat-number">{{ "{:,}".format(stats.shooting.total_shots_fired) }}</div>
            </article>

            <article class="stat-card highlight">
                <h4>🎯 Shot Accuracy</h4>
                <div class="stat-number">{{ stats.shooting.shot_accuracy }}%</div>
            </article>
        </div>
    </section>

    <!-- Farming Statistics -->
    <section>
        <h2>🌾 Farming Statistics</h2>
        <div class="stats-grid">
            <article class="stat-card">
                <h4>🐛 Creep Kills</h4>
                <div class="stat-number">{{ "{:,}".format(stats.farming.total_creep_kills) }}</div>
            </article>

            <article class="stat-card">
                <h4>⚡ Last Hits</h4>
                <div class="stat-number">{{ "{:,}".format(stats.farming.total_last_hits) }}</div>
            </article>

            <article class="stat-card">
                <h4>🚫 Denies</h4>
                <div class="stat-number">{{ "{:,}".format(stats.farming.total_denies) }}</div>
            </article>

            <article class="stat-card">
                <h4>📢 Total Pings</h4>
                <div class="stat-number">{{ "{:,}".format(stats.communication.total_pings) }}</div>
            </article>
        </div>
    </section>

    <!-- Match Duration -->
    <section>
        <h2>⏱️ Match Duration</h2>
        <div class="stats-grid">
            <article class="stat-card">
                <h4>📊 Average Duration</h4>
                <div class="stat-number">{{ stats.duration.avg_duration | format_duration }}</div>
            </article>

            <article class="stat-card">
                <h4>⚡ Shortest Match</h4>
                <div class="stat-number">{{ stats.duration.min_duration | format_duration }}</div>
                <small><a href="{{ url_for('match_detail', match_id=stats.duration.min_match_id) }}">#{{ stats.duration.min_match_id }}</a></small>
            </article>

            <article class="stat-card">
                <h4>🐌 Longest Match</h4>
                <div class="stat-number">{{ stats.duration.max_duration | format_duration }}</div>
                <small><a href="{{ url_for('match_detail', match_id=stats.duration.max_match_id) }}">#{{ stats.duration.max_match_id }}</a></small>
            </article>

            <article class="stat-card">
                <h4>🕐 Total Playtime</h4>
                <div class="stat-number">{{ stats.duration.total_duration | format_duration }}</div>
            </article>
        </div>
    </section>

    <!-- Team Balance -->
    <section>
        <h2>⚖️ Team Balance</h2>
        <div class="stats-grid">
            <article class="stat-card amber">
                <h4>🟡 Amber Wins</h4>
                <div class="stat-number">{{ "{:,}".format(stats.teams.amber_wins) }}</div>
            </article>

            <article class="stat-card sapphire">
                <h4>🔵 Sapphire Wins</h4>
                <div class="stat-number">{{ "{:,}".format(stats.teams.sapphire_wins) }}</div>
            </article>
        </div>
    </section>

    <!-- Top Performers - Fixed 3 per Row -->
    <section>
        <h2>🏆 Top Performers</h2>
        
        <div class="top-performers-container">
            <!-- First Row -->
            <div class="performers-row">
                <!-- Top Killers -->
                <article>
                    <h3>💀 Top Killers</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Kills</th>
                                    <th>Match</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player, kills, match_id in stats.top_performers.killers %}
                                <tr>
                                    <td>{{ player or "Unknown" }}</td>
                                    <td>{{ kills }}</td>
                                    <td><a href="{{ url_for('match_detail', match_id=match_id) }}">#{{ match_id }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </article>

                <!-- Top Damage Dealers -->
                <article>
                    <h3>💥 Top Damage</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Damage</th>
                                    <th>Match</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player, damage, match_id in stats.top_performers.damage_dealers %}
                                <tr>
                                    <td>{{ player or "Unknown" }}</td>
                                    <td>{{ "{:,}".format(damage) }}</td>
                                    <td><a href="{{ url_for('match_detail', match_id=match_id) }}">#{{ match_id }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </article>

                <!-- Top Healers -->
                <article>
                    <h3>💚 Top Healers</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Healing</th>
                                    <th>Match</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player, healing, match_id in stats.top_performers.healers %}
                                <tr>
                                    <td>{{ player or "Unknown" }}</td>
                                    <td>{{ "{:,}".format(healing) }}</td>
                                    <td><a href="{{ url_for('match_detail', match_id=match_id) }}">#{{ match_id }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </article>
            </div>

            <!-- Second Row -->
            <div class="performers-row">
                <!-- Top Souls -->
                <article>
                    <h3>💰 Top Souls</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Souls</th>
                                    <th>Match</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player, souls, match_id in stats.top_performers.souls %}
                                <tr>
                                    <td>{{ player or "Unknown" }}</td>
                                    <td>{{ "{:,}".format(souls) }}</td>
                                    <td><a href="{{ url_for('match_detail', match_id=match_id) }}">#{{ match_id }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </article>

                <!-- Best KDA -->
                <article>
                    <h3>🎯 Best KDA</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>KDA</th>
                                    <th>Match</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player, kda, kills, deaths, assists, match_id in stats.top_performers.kda %}
                                <tr>
                                    <td>{{ player or "Unknown" }}</td>
                                    <td><strong>{{ kda }}</strong></td>
                                    <td><a href="{{ url_for('match_detail', match_id=match_id) }}">#{{ match_id }}</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </article>
                

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--pico-card-background-color);
    border: 1px solid var(--pico-card-border-color);
    border-radius: var(--pico-border-radius);
    padding: 1.5rem;
    text-align: center;
    transition: transform 0.2s ease;
    min-height: 160px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--pico-card-box-shadow);
}

.stat-card h3, .stat-card h4 {
    margin: 0 0 0.75rem 0;
    font-size: 0.85rem;
    color: var(--pico-muted-color);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.3;
    word-wrap: break-word;
    hyphens: auto;
}

.stat-number {
    font-size: 1.4rem;
    font-weight: bold;
    color: var(--pico-primary-color);
    margin-bottom: 0.5rem;
    line-height: 1.1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.hero-name {
    font-size: 1rem;
    font-weight: 600;
    color: var(--pico-color);
    margin-bottom: 0.5rem;
}

.stat-card small {
    color: var(--pico-muted-color);
    font-size: 0.75rem;
    line-height: 1.3;
    margin-top: 0.25rem;
}

.stat-card small a {
    color: var(--pico-primary-color);
    text-decoration: none;
}

.stat-card small a:hover {
    text-decoration: underline;
}

.stat-card.highlight {
    border-color: var(--pico-primary-color);
    background: linear-gradient(135deg, var(--pico-card-background-color) 0%, rgba(var(--pico-primary-color-rgb), 0.1) 100%);
}

.stat-card.record {
    border-color: #f59e0b;
    background: linear-gradient(135deg, var(--pico-card-background-color) 0%, rgba(245, 158, 11, 0.1) 100%);
}

.stat-card.amber {
    border-color: #fbbf24;
    background: linear-gradient(135deg, var(--pico-card-background-color) 0%, rgba(251, 191, 36, 0.1) 100%);
}

.stat-card.sapphire {
    border-color: #3b82f6;
    background: linear-gradient(135deg, var(--pico-card-background-color) 0%, rgba(59, 130, 246, 0.1) 100%);
}

/* Top Performers - Fixed 3 per row layout */
.top-performers-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.performers-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 2rem;
}

.performers-row article {
    background: var(--pico-card-background-color);
    border: 1px solid var(--pico-card-border-color);
    border-radius: var(--pico-border-radius);
    padding: 1.5rem;
    min-height: 250px;
}

.performers-row h3 {
    margin-top: 0;
    margin-bottom: 1rem;
    text-align: center;
    font-size: 1rem;
}

.table-container {
    overflow-x: auto;
}

.table-container table {
    font-size: 0.85rem;
    width: 100%;
}

section {
    margin-bottom: 3rem;
}

section h2 {
    border-bottom: 2px solid var(--pico-primary-color);
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
}

@media (max-width: 1200px) {
    .performers-row {
        grid-template-columns: 1fr 1fr;
    }
    .performers-row article:nth-child(3) {
        grid-column: 1 / -1;
        max-width: 50%;
        margin: 0 auto;
    }
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    
    .stat-number {
        font-size: 1.2rem;
    }
    
    .stat-card {
        min-height: 140px;
    }
    
    .performers-row {
        grid-template-columns: 1fr;
    }
    .performers-row article:nth-child(3) {
        grid-column: auto;
        max-width: 100%;
        margin: 0;
    }
}
</style>
{% endblock %}